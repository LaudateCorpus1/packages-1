{
  "name": "msnodesqlv8",
  "description": "Microsoft Driver for Node.js SQL Server compatible with all versions of Node.",
  "author": {
    "name": "Stephen James"
  },
  "contributors": [
    {
      "name": "Microsoft"
    },
    {
      "name": "Stephen James"
    }
  ],
  "version": "0.2.10",
  "keywords": [
    "sql",
    "prepared",
    "statements",
    "database",
    "procedure",
    "sproc",
    "mssql",
    "azure",
    "sqlserver",
    "tds",
    "microsoft",
    "msnodesql",
    "node-sqlserver"
  ],
  "homepage": "https://github.com/TimelordUK/node-sqlserver-v8",
  "licenses": [
    {
      "type": "Apache 2.0",
      "url": "https://github.com/TimelordUK/node-sqlserver-v8/blob/master/LICENSE"
    }
  ],
  "main": "./lib/sql.js",
  "repository": {
    "user": "TimelordUK",
    "repo": "node-sqlserver-v8",
    "host": "github.com",
    "branch": "master",
    "apiHost": "api.github.com",
    "tarball_url": "https://api.github.com/repos/TimelordUK/node-sqlserver-v8/tarball/master",
    "clone_url": "https://github.com/TimelordUK/node-sqlserver-v8",
    "https_url": "https://github.com/TimelordUK/node-sqlserver-v8",
    "travis_url": "https://travis-ci.org/TimelordUK/node-sqlserver-v8",
    "zip_url": "https://github.com/TimelordUK/node-sqlserver-v8/archive/master.zip",
    "api_url": "https://api.github.com/repos/TimelordUK/node-sqlserver-v8"
  },
  "engines": {
    "node": ">=0.12"
  },
  "devDependencies": {
    "electron": "^1.4.3",
    "minimist": "^1.2.0",
    "mocha": ">=2.2.5"
  },
  "os": [
    "win32"
  ],
  "gitHead": "e025462083dd1140eed2519c449bc257482bc61b",
  "scripts": {},
  "_resolved": "https://registry.npmjs.org/msnodesqlv8/-/msnodesqlv8-0.1.35.tgz",
  "_npmVersion": "3.8.6",
  "_nodeVersion": "5.12.0",
  "dist": {
    "shasum": "12f87c3ed8d1a89c5f4f3f39fcaf4c64d6b5a5a5",
    "tarball": "http://registry.npmjs.org/msnodesqlv8/-/msnodesqlv8-0.2.10.tgz"
  },
  "dependencies": {},
  "stars": 3,
  "versions": [
    {
      "number": "0.1.0",
      "date": "2015-09-21T21:06:30.477Z"
    },
    {
      "number": "0.1.1",
      "date": "2015-09-21T21:13:47.436Z"
    },
    {
      "number": "0.1.2",
      "date": "2015-09-21T21:21:47.652Z"
    },
    {
      "number": "0.1.3",
      "date": "2015-09-21T21:30:08.166Z"
    },
    {
      "number": "0.1.4",
      "date": "2015-09-21T21:40:24.847Z"
    },
    {
      "number": "0.1.5",
      "date": "2015-09-21T23:26:14.644Z"
    },
    {
      "number": "0.1.6",
      "date": "2015-09-21T23:32:42.615Z"
    },
    {
      "number": "0.1.7",
      "date": "2015-09-25T11:21:49.139Z"
    },
    {
      "number": "0.1.8",
      "date": "2015-09-25T11:34:44.895Z"
    },
    {
      "number": "0.1.11",
      "date": "2015-10-24T13:54:42.107Z"
    },
    {
      "number": "0.1.14",
      "date": "2015-10-24T14:07:46.430Z"
    },
    {
      "number": "0.1.15",
      "date": "2015-12-12T22:04:36.882Z"
    },
    {
      "number": "0.1.16",
      "date": "2015-12-12T22:09:10.044Z"
    },
    {
      "number": "0.1.17",
      "date": "2015-12-13T11:48:10.227Z"
    },
    {
      "number": "0.1.18",
      "date": "2015-12-17T16:54:26.375Z"
    },
    {
      "number": "0.1.19",
      "date": "2015-12-17T19:35:51.896Z"
    },
    {
      "number": "0.1.20",
      "date": "2015-12-18T18:10:08.394Z"
    },
    {
      "number": "0.1.21",
      "date": "2015-12-18T22:26:58.838Z"
    },
    {
      "number": "0.1.22",
      "date": "2015-12-19T20:18:53.082Z"
    },
    {
      "number": "0.1.23",
      "date": "2015-12-22T17:09:59.372Z"
    },
    {
      "number": "0.1.24",
      "date": "2015-12-22T20:44:27.454Z"
    },
    {
      "number": "0.1.25",
      "date": "2015-12-22T20:54:17.048Z"
    },
    {
      "number": "0.1.26",
      "date": "2015-12-23T18:00:03.635Z"
    },
    {
      "number": "0.1.27",
      "date": "2015-12-25T20:42:01.865Z"
    },
    {
      "number": "0.1.28",
      "date": "2015-12-27T17:15:44.713Z"
    },
    {
      "number": "0.1.29",
      "date": "2015-12-28T18:45:06.080Z"
    },
    {
      "number": "0.1.30",
      "date": "2015-12-29T17:37:43.468Z"
    },
    {
      "number": "0.1.31",
      "date": "2015-12-29T17:45:36.482Z"
    },
    {
      "number": "0.1.32",
      "date": "2015-12-29T17:54:12.116Z"
    },
    {
      "number": "0.1.33",
      "date": "2015-12-29T18:01:26.628Z"
    },
    {
      "number": "0.1.34",
      "date": "2015-12-29T18:26:02.401Z"
    },
    {
      "number": "0.1.35",
      "date": "2015-12-29T18:32:04.208Z"
    },
    {
      "number": "0.1.37",
      "date": "2016-05-07T15:19:33.447Z"
    },
    {
      "number": "0.1.38",
      "date": "2016-05-07T15:23:41.222Z"
    },
    {
      "number": "0.1.39",
      "date": "2016-05-07T15:45:30.068Z"
    },
    {
      "number": "0.1.40",
      "date": "2016-05-12T20:42:21.460Z"
    },
    {
      "number": "0.1.41",
      "date": "2016-05-13T20:07:20.645Z"
    },
    {
      "number": "0.1.42",
      "date": "2016-05-15T18:46:40.944Z"
    },
    {
      "number": "0.1.43",
      "date": "2016-05-19T21:55:12.256Z"
    },
    {
      "number": "0.1.44",
      "date": "2016-05-24T23:42:03.309Z"
    },
    {
      "number": "0.1.45",
      "date": "2016-05-28T16:39:29.792Z"
    },
    {
      "number": "0.1.46",
      "date": "2016-07-05T21:16:04.020Z"
    },
    {
      "number": "0.2.1",
      "date": "2016-07-24T15:42:35.173Z"
    },
    {
      "number": "0.2.2",
      "date": "2016-07-25T09:10:19.248Z"
    },
    {
      "number": "0.2.3",
      "date": "2016-07-25T20:14:01.101Z"
    },
    {
      "number": "0.2.4",
      "date": "2016-08-07T14:31:48.177Z"
    },
    {
      "number": "0.2.5",
      "date": "2016-08-07T14:46:51.721Z"
    },
    {
      "number": "0.2.6",
      "date": "2016-08-07T15:05:32.208Z"
    },
    {
      "number": "0.2.8",
      "date": "2016-08-07T15:22:12.189Z"
    },
    {
      "number": "0.2.9",
      "date": "2016-09-20T19:55:07.323Z"
    },
    {
      "number": "0.2.10",
      "date": "2016-10-15T11:54:35.936Z"
    }
  ],
  "created": "2015-09-21T21:06:30.477Z",
  "modified": "2016-10-15T11:54:35.936Z",
  "lastPublisher": {
    "name": "timelorduk",
    "email": "sjames8888@gmail.com"
  },
  "owners": [
    {
      "name": "timelorduk",
      "email": "sjames8888@gmail.com"
    }
  ],
  "readme": "# Note\r\n\r\nThis driver is branched from the Microsft node-sqlserver module. The MS team are working on an entirely new version and in the interim this version will be gradually improved to include new features.\r\n# Microsoft / Contributors Node V8 Driver for Node.js for SQL Server\r\n\r\nThis version includes stored procedure support and bulk insert/delete/amend for SQL Server\r\n\r\n1. supports input/output parameters.\r\n2. captures return code from stored procedure.\r\n3. will obtain meta data describing parameters.\r\n4. compatibe with Node 0.12.x / 4.x.x / 5.x.x / 6.x.x\r\n5. includes 64 bit/ia32 precompiled libraries.\r\n6. npm install with npm install msnodesqlv8\r\n7. new features to be made available over coming months.\r\n8. bulk table operations insert,delete,update\r\n\r\n# **NODE-SQLSERVER-V8**\r\n\r\n## Node JS support for SQL server \r\n\r\nBased on node-sqlserver, this version will compile in Visual Studio 2013/2015 and is built against the v8 node module API.  The module will work against node version 0.12.x. and >= 4.1.x.    Included in the repository are pre compiled binaries for both x64 and x86 targets.  \r\n\r\nFunctionally the API should work exactly as the existing library. The existing unit tests pass based on Node 0.12 and also against Node 4.2.1.\r\n\r\n## Node >= 5.12.0\r\n\r\nThe library has been built against the latest Node 5 version.  The test cases pass OK.\r\n\r\n## Node >= 6.2.2\r\n\r\nThe library has been built against the latest Node 6 version.  The test cases pass OK, please take library for a spin. Note native libraries have been included, it should work out the box.\r\n\r\n## Prepared Statements\r\n\r\nIt is now possible to prepare one or more statements which can then be invoked\r\nover and over with different parameters.  There are a few examples in the prepared unit tests.\r\nPlease note that prepared statements must be closed as shown below when they are no longer required.\r\nEach prepared statement utilises server resources so the application should open and close appropriately.\r\n\r\nPrepared Statements can be useful when there is a requirement to run the same SQL with different\r\nparameters many times.  This saves overhead from constantly submitting the same SQL to the server.\r\n\r\n    function employeePrepare(done) {\r\n\r\n    var query =\r\n        `SELECT [ModifiedDate]\r\n        ,[BusinessEntityID]\r\n        ,[OrganizationNode]\r\n        ,[ModifiedDate]\r\n        FROM [scratch].[dbo].[Employee]\r\n        WHERE BusinessEntityID = ?`;\r\n\r\n    // open connection\r\n    sql.open(connStr, function (err, conn) {\r\n        assert.ifError(err);\r\n        // prepare a statement which can be re-used\r\n        conn.prepare(query, function (e, ps) {\r\n            // called back with a prepared statement\r\n            console.log(ps.getMeta());\r\n            // prepared query meta data avaialble to view\r\n            assert.ifError(err);\r\n            // execute with expected paramater\r\n            ps.preparedQuery([1], function(err, fetched) {\r\n                console.log(fetched);\r\n                // can call again with new parameters.\r\n                // note - free the statement when no longer used,\r\n                // else resources will be leaked.\r\n                ps.free(function() {\r\n                    done();\r\n                })\r\n            });\r\n        });\r\n    });\r\n    }\r\n\r\n\r\n\r\n## Connect Timeout\r\n\r\nsend in a connect object to pass a timeout to the driver for connect request\r\n\r\n    function connect_timeout() {\r\n        var co = {\r\n            conn_str : connStr,\r\n            conn_timeout : 2\r\n        };\r\n        var start = new Date().getTime();\r\n        console.log ('connect ' + start);\r\n        sql.open(co, function(err, conn) {\r\n            var end = new Date().getTime();\r\n            var elapsed = end - start;\r\n            console.log ('callback ..... ' + elapsed );\r\n            if (err) {\r\n                console.log(err);\r\n                return;\r\n            }\r\n            var ts = new Date().getTime();\r\n            conn.query(\"declare @v time = ?; select @v as v\", [sql.Time(ts)], function (err, res) {\r\n                assert.ifError(err);\r\n                console.log(res);\r\n            });\r\n        });\r\n\r\n## Query Timeout\r\n\r\nsend in a query object such as that shown below to set a timeout for a particular query.  Note usual semantics of using a sql string parameter will result in no timeout being set\r\n\r\n        open(function(conn) {\r\n            var queryObj = {\r\n                query_str : \"waitfor delay \\'00:00:10\\';\",\r\n                query_timeout : 2\r\n            };\r\n\r\n            conn.query(queryObj, function (err, res) {\r\n                assert(err != null);\r\n                assert(err.message.indexOf('Query timeout expired') > 0)\r\n                test_done();\r\n            });\r\n        });\r\n\r\nA timeout can also be used with a stored procedure call as follows :-\r\n\r\n        function go() {\r\n            var pm = c.procedureMgr();\r\n            pm.setTimeout(2);\r\n            pm.callproc(sp_name, ['0:0:5'], function(err, results, output) {\r\n                assert(err != null);\r\n                assert(err.message.indexOf('Query timeout expired') > 0)\r\n                test_done();\r\n            });\r\n        }\r\n\r\n## User Binding Of Parameters\r\n\r\nIn many cases letting the driver decide on the parameter type is sufficient.  There are occasions however where more control is required. The API now includes some methods which explicitly set the type alongside the value.  The driver will in this case\r\nuse the type as provided.  For example, to set column type as binary and pass in null value, use the sql.VarBinary as shown below.  There are more examples in test harness file userbind.js.\r\n\r\n     sql.open(connStr, function(err, conn) {\r\n         conn.query(\"declare @bin binary(4) = ?; select @bin as bin\", [sql.VarBinary(null)], function (err, res) {\r\n             var expected = [ {\r\n                 'bin' : null\r\n             }];\r\n             assert.ifError(err);\r\n             assert.deepEqual(expected, res);\r\n         });\r\n     });\r\n\r\n## Stored Procedure Support \r\n\r\nIncluded in this module is support for stored procedures in SQL server.  Simple input/output parameters and return value can be bound.  \r\n\r\nopen a connection, and get an instance of procedureMgr\r\n\r\n        sql.open(conn_str, function (err, conn) {\r\n                var pm = conn.procedureMgr();\r\n                pm.callproc('my_proc', [10], function(err, results, output) {\r\n            });\r\n        });\r\n\r\nin above example a call is issued to the stored procedure my_proc which takes one input integer parameter.  results will contain rows selected within the procedure and output parameters are inserted into output vector.  Note the [0] element in output will be the return result of the procedure.  If no return exists in the procedure, this value will be 0.  Any further elements in the array will be output parameters populated by the execution of the procedure.\r\n\r\nNote the manager will issue a select to the database to obtain meta data about the procedure.  This is cached by the manager.  It is possible to obtain this information for inspection.\r\n\r\n    pm.describe(name, function (meta) {\r\n        console.log(JSON.stringify(meta));\r\n        pm.callproc('my_proc', [10], function (err, results, output) {\r\n        });\r\n    });\r\n\r\nmeta will contain the parameter array associated with the procedure, the type, size and call signature required.  \r\n\r\nthe test folder includes some simple unit tests for stored procedures.  If you discover any problems with using this new feature please include a simple example, preferably a unit test illustrating the issue.  I will endeavour to fix the issue promptly.\r\n\r\nFurther enhancements will be made to the library over the coming months - please leave feedback or suggestions for required features.\r\n\r\n## Bulk Table Operations\r\n\r\nBulk insert/delete/modify is now supported through a helper class.  The underlying c++ driver will reserve vectors containing the column data and submit in bulk to the database which will reduce network overhead.  It is possible to configure in the java script a batch size which will break the master vector of objects down into batches each of which is prepared and sent by the driver. Most of the effort for this update was spent in getting the c++ driver to work, the js API still needs a little refinement, so please use the feature and make suggestions for improvements.\r\n\r\nIf issues are found, please provide the exact table definition being used and ideally a unit test illustrating the problem. \r\n\r\ntake a look at the unit test file bulk.js to get an idea of how to use these new functions.\r\n\r\nonce a connection is opened, first get the table manager :-\r\n\r\n            var tm = c.tableMgr();\r\n            tm.bind('Employee', cb);\r\n\r\nthe table manager will fetch some meta data describing the table 'Employee' and make a callback providing a manager for that particular table :-\r\n\r\n            function cb(bulkMgr) {\r\n              // bulkMgr is now ready to accept bulk operations for table 'Employee'\r\n              // see employee.json and employee.sql in test.\r\n              var parsedJSON = getJSON(); // see bulk.js\r\n              bulkMgr.insertRows(parsedJSON, insertDone);\r\n            }\r\n\r\nyou can look at the signatures, columns and other interesting information by asking for a summary :-\r\n\r\n             var summary = bulkMgr.getSummary();\r\n\r\nby default the primary key of the table is assigned to the where condition for select which gives a convenient way of selecting a set of rows based on knowing the keys.  Note this operation is not yet optimized with bulk fetch, which will be enhanced in the next update addressing cursors.\r\n\r\n             keys = [];\r\n             keys.push(\r\n                 {\r\n                     BusinessEntityID : 1  \r\n                 }\r\n             );\r\n             bulkMgr.selectRows(keys, function(err, results) {\r\n                 // results will contain the full object i.e. all columns,\r\n             }\r\n             ); \r\n\r\nit is possible to change the where clause by using a different column signature - for example, LoginID\r\n\r\n            var whereCols = [];\r\n            whereCols.push({\r\n                name : 'LoginID'\r\n            });\r\n            // as above keys now needs to contain a vector of LoginID\r\n            bulkMgr.setWhereCols(whereCols);\r\n            bulkMgr.selectRows(keys, bulkDone);\r\n \r\namends can be made to a sub set of columns, for example to bulk update the modified date, prepare a set of objects with the primary keys to satisfy the where clause and of course the column to be updated. By default all assignable columns are used for the update signature so the entire object would need to be presented.  Where performance is within acceptable limits, this is probably the easiest pattern i.e. select the entire object, amend as required and commit the amended vector back to the database.\r\n\r\n\r\n                var newDate = new Date(\"2015-01-01T00:00:00.000Z\");\r\n                var modifications = [];\r\n                parsedJSON.forEach(function(emp) {\r\n                    emp.ModifiedDate = newDate;\r\n                    modifications.push( {\r\n                        BusinessEntityID : emp.BusinessEntityID,\r\n                        ModifiedDate : newDate\r\n                    });\r\n                });\r\n\r\ntell the bulkMgr which columns to use for the update and send in the modification :-\r\n\r\n                var updateCols = [];\r\n                updateCols.push({\r\n                    name : 'ModifiedDate'\r\n                });\r\n\r\n                bulkMgr.setUpdateCols(updateCols);\r\n                bulkMgr.updateRows(modifications, updateDone);\r\n\r\nthe manager can also delete rows - the where clause is used in binding signature so by default this will be the primary key.  Similar to the select examples above :-\r\n\r\n                 bulkMgr.deleteRows(keys, function (err, res) {\r\n                 })\r\n\r\nof course keys can be the original objects as fetched with select - the driver only needs all columns that satisfy the where condition of the signature.\r\n\r\n\r\nfinally, to reset the signatures the summary can help :-\r\n\r\n                 var summary = bulkMgr.getSummary();\r\n                 bulkMgr.setWhereCols(summary.primaryColumns);\r\n                 bulkMgr.setUpdateCols(summary.assignableColumns);\r\n\r\n \r\nFurther enhancements will be made to the library over the coming months - please leave feedback or suggestions for required features.\r\n\r\n## Test\r\n\r\nIncluded are a few unit tests.  They require mocha, async, and assert to be \r\ninstalled via npm.  Also, set the variables in test-config.js, then run the \r\ntests as follows:\r\n\r\n    cd test\r\n    node runtests.js\r\n\r\nnote if you wish to run the code through an IDE such as PHPStorm, the following fragment may help :-\r\n\r\n    function runTest() {\r\n\r\n    var mocha = new Mocha(\r\n        {\r\n            ui : 'tdd'\r\n        });\r\n\r\n    -- change path as required to unit test file, set breakpoint and run via IDE\r\n    \r\n    mocha.addFile('node_modules/node-sqlserver-v8/test/huge-bulk.js');\r\n\r\n    mocha.run(function (failures) {\r\n        process.on('exit', function () {\r\n            process.exit(failures);\r\n        });\r\n    });\r\n\r\n\r\n## Known Issues\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"
}