{
  "name": "accountifie-svc",
  "version": "1.1.3",
  "description": "A simple REST ledger service with running balances. Perfect for use with accountifie.",
  "main": "app.js",
  "bin": {
    "accountifie-server": "./bin/accountifie-svc"
  },
  "repository": {
    "user": "electronifie",
    "repo": "accountifie-svc",
    "host": "github.com",
    "branch": "master",
    "apiHost": "api.github.com",
    "tarball_url": "https://api.github.com/repos/electronifie/accountifie-svc/tarball/master",
    "clone_url": "https://github.com/electronifie/accountifie-svc",
    "https_url": "https://github.com/electronifie/accountifie-svc",
    "travis_url": "https://travis-ci.org/electronifie/accountifie-svc",
    "zip_url": "https://github.com/electronifie/accountifie-svc/archive/master.zip",
    "api_url": "https://api.github.com/repos/electronifie/accountifie-svc"
  },
  "author": {
    "name": "andrew.mckenzie@electronifie.com"
  },
  "homepage": "https://electronifie.github.io/accountifie-svc",
  "license": "MIT",
  "scripts": {
    "test": "make test"
  },
  "keywords": [
    "finance",
    "REST",
    "accountifie",
    "ledger",
    "running balance",
    "account",
    "transaction"
  ],
  "dependencies": {
    "async": "^1.2.1",
    "bignumber.js": "^2.0.7",
    "body-parser": "^1.13.1",
    "bunyan": "^1.5.1",
    "cconfig": "^0.1.1",
    "errortrap": "1.0.1",
    "express": "^4.12.4",
    "format": "^0.2.1",
    "llog": "0.0.12",
    "lodash": "^3.9.3",
    "moment": "^2.10.3",
    "mongodb": "^2.0.34",
    "mongoose": "^4.2.7",
    "response-time": "^2.3.1",
    "sourced": "0.0.14",
    "sourced-repo-mongo": "^0.3.6",
    "validate": "^2.1.6"
  },
  "devDependencies": {
    "apidoc": "^0.14.0",
    "chai": "^3.5.0",
    "chainbuilder": "^2.1.1",
    "chainbuilder-flow": "^1.0.2",
    "chainbuilder-lodash": "^2.0.0",
    "chainbuilder-log-console": "^1.0.3",
    "chainbuilder-save": "^1.0.0",
    "change-case": "^2.3.0",
    "cucumber": "^0.9.1",
    "mocha": "^2.4.5",
    "pg": "^4.4.0",
    "pg-cursor": "^1.0.0",
    "request": "^2.58.0",
    "require-dir": "^0.3.0",
    "should": "^7.0.1",
    "sinon": "^1.17.3",
    "stylish-commit-auto-hook-install": "0.0.7",
    "supertest": "^1.2.0",
    "supervisor": "^0.9.1",
    "underscore-cli": "^0.2.18"
  },
  "apidoc": {
    "name": "Accountifie Service",
    "title": "accountifie-svc docs",
    "header": {
      "title": "accountifie-svc",
      "filename": "README.md"
    },
    "url": "http://localhost:5124"
  },
  "gitHead": "08c48a852c68221a097d932bab3b085768f66ed4",
  "_npmVersion": "3.6.0",
  "_nodeVersion": "5.6.0",
  "dist": {
    "shasum": "7b1e568d04efcffdb0b71dc599e987dbb486c9db",
    "tarball": "http://registry.npmjs.org/accountifie-svc/-/accountifie-svc-1.1.3.tgz"
  },
  "versions": [
    {
      "number": "1.0.0",
      "date": "2015-12-07T19:42:48.953Z"
    },
    {
      "number": "1.0.1",
      "date": "2015-12-14T17:18:19.331Z"
    },
    {
      "number": "1.0.2",
      "date": "2015-12-14T17:28:24.049Z"
    },
    {
      "number": "1.0.3",
      "date": "2015-12-15T20:31:20.254Z"
    },
    {
      "number": "1.0.4",
      "date": "2015-12-17T01:23:53.290Z"
    },
    {
      "number": "1.0.5",
      "date": "2015-12-19T06:44:24.941Z"
    },
    {
      "number": "1.0.6",
      "date": "2016-01-13T20:11:25.739Z"
    },
    {
      "number": "1.0.7",
      "date": "2016-02-26T17:27:49.195Z"
    },
    {
      "number": "1.0.8",
      "date": "2016-02-26T21:18:35.680Z"
    },
    {
      "number": "1.0.9",
      "date": "2016-03-02T16:50:22.484Z"
    },
    {
      "number": "1.0.10",
      "date": "2016-03-16T18:38:50.927Z"
    },
    {
      "number": "1.1.1",
      "date": "2016-03-17T14:14:13.836Z"
    },
    {
      "number": "1.1.2",
      "date": "2016-04-08T16:33:45.407Z"
    },
    {
      "number": "1.1.3",
      "date": "2016-05-18T17:19:20.808Z"
    }
  ],
  "created": "2015-12-07T19:42:48.953Z",
  "modified": "2016-06-06T14:47:17.248Z",
  "lastPublisher": {
    "name": "andrewpmckenzie",
    "email": "andrew.mckenzie@electronifie.com"
  },
  "owners": [
    {
      "name": "andrewpmckenzie",
      "email": "andrewpmckenzie@gmail.com"
    }
  ],
  "readme": "[![Build Status](https://travis-ci.org/electronifie/accountifie-svc.svg)](https://travis-ci.org/electronifie/accountifie-svc)\n[![npm version](https://badge.fury.io/js/accountifie-svc.svg)](https://www.npmjs.com/package/accountifie-svc)\n[![GitHub stars](https://img.shields.io/github/release/electronifie/accountifie-svc.svg?style=social&label=Source)](https://github.com/electronifie/accountifie-svc)\n\n<hr>\n\n**To install:** `npm install accountifie-svc -g`  \n\n**To run:** `PORT=5124 MONGO_URL=mongodb://localhost:27017/accountifie accountifie-server`\n\n**To test:** `npm test`\n\n<hr>\n\nA few-frills REST ledger server built to support [**Accountifie**](https://github.com/electronifie/accountifie), but\nalso works as a standalone server.\n\nBasic features:\n - stores ledgers for multiple companies.\n - stores transactions.\n - groups a transaction's balancing entries across multiple accounts.\n - generates balances for an account at a given date.\n\nSpecial features:\n - balance caching for faster balance retrieval.\n - multi-day transactions for cases like depreciation.\n - fetching of transaction-list state at a given point in time. Useful for troubleshooting discrepencies.\n   in a report for a given date caused by back-dated or updated transactions.\n - filtering of balances to exclude transactions for selected counterparties or contra accounts.\n\n**Accountifie** is a django frontend with advanced permission and reporting features. It provides a platform for you to create custom\nobjects for your business's domain that result in generated transactions, and tools for tailoring your own financial\nreports with advanced export options. More information is available [on github](https://github.com/electronifie/accountifie).\n\n## Ledgers and Accounts and Transactions, oh my!\n\nThe world consists of [**General Ledgers**](https://github.com/electronifie/accountifie-svc/blob/master/lib/models/generalLedger.js),\nalso known as **GLs**. Each GL contains sets of [**Transactions**](https://github.com/electronifie/accountifie-svc/blob/master/lib/models/transaction.js)\nand [**Accounts**](https://github.com/electronifie/accountifie-svc/blob/master/lib/models/account.js).\n\nA Transaction contains **Lines**, each with a balance and an Account. All a Transaction's Lines should balance to 0. A Line's\n**Contra Accounts** are the Accounts of _all other_ Lines for that transaction. A Transaction may occur on a single date\nor, to avoid highly repetitive transactions like depreciation, may be spread across a period (referred to as a **multi-date**\ntransaction).\n\nAn Account contains references to all Transactions that have at least one Line for that Account. An Account also has a\n**Balance** at any date. The Balance is calculated by summing the Account's Line amounts up to that date.\n\nThe models also contain references to **Counterparties** and **Business Model Objects (BMOs)** which are stored and\nreturned for convenience, but not really used by the service (except for filtering).\n\n## How it works\n\nThe service's focus has been on operational speed, especially when calculating balances. All objects are kept in\nmemory, sometimes at the cost of startup time. Changes are persisted to mongo using the event sourcing pattern provided\nby sourced. Most implementation details have been spec'd out in \n[the tests](https://github.com/electronifie/accountifie-svc/blob/master/features/general-ledger.feature).\n\n#### Persistence with sourced\n\nThe system uses [**sourced**](https://github.com/mateodelnorte/sourced) for\npersistence, a library that persists and replays method calls with their passed params to restore an entity's\n(in our case GeneralLedger) state. This can have some impact on startup time, though uses snapshotting to minimise the\neffect.\n\nSourced has the advantages of leaving a comprehensive audit trail, and enabling us to recreate the state of the system\nat a given timestamp - something we've built upon with the\n[`/gl/:LEDGER_ID/snapshot/transactions`](http://electronifie.github.io/accountifie-svc/#api-Ledger_Utils-GetGlLedger_idSnapshotTransactions) endpoint.\n\nThe best way to see a ledger's state via the database is in the `GeneralLedger.snapshots` collection. To get the latest\nsnapshot, query by `{id: LEDGER_ID}`, sort by `{version: -1}` and limit to 1 result.\n\n#### Balance generation\n\nGenerating balances based on thousands of transactions has some impact on performance, especially as we're using BigNumber to\nprevent floating point arithmetic issues. To improve performance, we use a\n[**Balance Cache**](https://github.com/electronifie/accountifie-svc/blob/master/lib/models/accountBalanceCache.js) for each\naccount at the monthly anniversary of the account's first transaction. Generating a balance for a date then involves only\nadding the transactions between the date and the Balance Cache immediately prior to the date. To make things even snappier\nwe also cache the result of every balance request that's processed, so the second time you hit `/gl/myco/balances?date=2015-01-13`\nwill probably be faster than the first.\n\nWhenever a transaction is added, updated, or deleted, all caches with dates after the transaction are invalidated. Regenerating the\ncaches can take seconds and, since node is unithreaded, get in the way of processing requests. To overcome this, the task is split\ninto microtasks (one per cache) which are placed on the\n[**Low Priority Queue**](https://github.com/electronifie/accountifie-svc/blob/master/lib/low-priority-queue/lowPriorityQueue.js)\n(aka the **LPQ**). The LPQ processes a microtask then sleeps for a bit so requests can be processed. This means the balance caches\ncould take a few minutes to generate after CUDing some old transactions, resulting in slowed balance fetching, but this is unlikely\nto have much real-world impact. You can monitor the status of the LPQ at\n[`/lpq/stats`](http://electronifie.github.io/accountifie-svc/#api-Util-GetLpqStats).\n\nBalances may be requested with a **Filter** that excludes Counterparties or Conta Accounts, or limit to a set of Counterparties.\nFiltered transactions are unable to use the cached balances generated for unfiltered transactions, nor is a filter able to\nuse the cached balances for a different filter, as a different set of transactions may be used to calculate the transactions. Because\nof this, each balance cache is also associated with a filter.\n\nBy default, only unfiltered transactions have balance caches generated automatically, though all requests will have the balance\ncached against the filter provided in the request. You can get caches to generate automatically for a filter by using the\n[`/gl/:LEDGER_ID/add-filter`](http://electronifie.github.io/accountifie-svc/#api-Ledger_Utils-PostGlLedger_idAddFilter) endpoint.\n\n#### Multi-day transactions\n\nSome Transactions, like depreciation, occur over a period instead of on a given date. These transactions have a `dateEnd` as well\nas a `date`. When a balance is calculated on a date that falls part-way through the period, it will contain only the portion of\nthe transaction's amount for the period that has lapsed. For instance, for a transaction with\n`date='2015-01-01', dateEnd='2015-01-04', amount='4.00'`:\n  - a balance on `2015-01-01` would include only $1 for that transaction.\n  - a balance on `2015-01-02` would include $2\n  - a balance on `2015-01-03` would include $3\n  - balances on `2015-01-04` and beyond would include all $4\n\nWhen requesting a list of transactions for a period that contains only a portion of the transaction, the transaction's amount will\nreflect the amount during the overlap and the transaction's `date` or `endDate` will be adjusted so the transaction fits within\nthe specified period. E.g. a transaction with `date='2015-01-01', dateEnd='2015-01-04', amount='4.00'`:\n - for `/gl/myco/tranactions?from=2015-01-02&to=2015-01-10` will return `date='2015-01-02', dateEnd='2015-01-04', amount='3.00'`\n - for `/gl/myco/tranactions?from=2014-12-01&to=2015-01-02` will return `date='2015-01-01', dateEnd='2015-01-02', amount='2.00'`\n - for `/gl/myco/tranactions?from=2015-01-02&to=2015-01-03` will return `date='2015-01-02', dateEnd='2015-01-03', amount='2.00'`\n\nFor reporting convenience, you can provide the `chunkFrequency=end-of-month` param to\n[`/gl/:LEDGER_ID/transactions`](http://electronifie.github.io/accountifie-svc/#api-Ledger-GetGlLedger_idTransaction), which\nwill break a multi-day transaction into multiple transactions at each month's boundary.\n\n#### Version history\n - *v1.1.3*  - 2016-05-18 - Verify unique ID when using /gl/:LEDGER_ID/transaction/:TX_ID/create\n - *v1.1.2*  - 2016-04-08 - Prevent snapshot generation if snapshot already exists\n - *v1.1.1*  - 2016-03-17 \n    - Return error if no data available for /gl/:LEDGER_ID/snapshot/create\n    - Attempt to use semver properly - the last release should have had a minor version bump. This is a patch.\n - *v1.0.10* - 2016-03-16 \n    - Add /gl/:LEDGER_ID/snapshot/balances\n    - Move /gl/:LEDGER_ID/snapshot-transactions to /gl/:LEDGER_ID/snapshot/transactions\n    - Move /gl/:LEDGER_ID/take-snapshot to /gl/:LEDGER_ID/snapshot/create and require a date be provided\n    - Add 'excludeTags' option to /gl/:LEDGER_ID/transactions\n    - Accept 'withTags' and 'excludeTags' filter options to /gl/:LEDGER_ID/balances\n - *v1.0.9*  - 2016-03-01 - Fix digest of deleteBmoTransactions.\n - *v1.0.8*  - 2016-02-26 - Fix cconfig bug when globally installed.\n - *v1.0.7*  - 2016-02-26 - Add /gl/:LEDGER_ID/bmo-transactions/:BMO_ID/delete\n"
}